<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© - Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø¹</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            direction: rtl;
        }

        .navbar-brand {
            font-weight: bold;
            color: #2c3e50 !important;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .safety-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .safety-safe { background-color: #d4edda; color: #155724; }
        .safety-warning { background-color: #fff3cd; color: #856404; }
        .safety-danger { background-color: #f8d7da; color: #721c24; }
        .safety-info { background-color: #d1ecf1; color: #0c5460; }

        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .progress-custom {
            height: 20px;
            border-radius: 10px;
            background-color: #e9ecef;
        }

        .progress-bar-custom {
            border-radius: 10px;
            transition: width 0.6s ease;
        }

        .table-modern {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .table-modern th {
            background-color: #f8f9fa;
            border: none;
            padding: 15px;
            font-weight: 600;
        }

        .table-modern td {
            border: none;
            padding: 12px 15px;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .refresh-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            background: linear-gradient(45deg, #764ba2, #667eea);
            color: white;
            transform: scale(1.05);
        }

        .metric-icon {
            font-size: 2.5rem;
            opacity: 0.7;
            margin-bottom: 10px;
        }

        .section-title {
            color: #2c3e50;
            font-weight: bold;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .alert-custom {
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .timestamp {
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-radiation"></i>
                Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø¹
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a class="nav-link" href="/employees">Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†</a>
                <a class="nav-link active" href="/comprehensive_reports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="summary-card text-center">
            <h1 class="mb-0">
                <i class="fas fa-chart-line me-2"></i>
                Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù…
            </h1>
            <p class="mt-2 mb-0">ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø¹ÙŠØ© ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</p>
            <div class="timestamp">
                Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastUpdate">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
            </div>
        </div>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div class="row mb-4">
            <div class="col-12 text-center">
                <button class="btn refresh-btn me-2" onclick="refreshAllData()">
                    <i class="fas fa-sync-alt me-1"></i>
                    ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <button class="btn btn-outline-primary" onclick="exportReport()">
                    <i class="fas fa-download me-1"></i>
                    ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </button>
                <button class="btn btn-outline-success" onclick="printReport()">
                    <i class="fas fa-print me-1"></i>
                    Ø·Ø¨Ø§Ø¹Ø©
                </button>
            </div>
        </div>

        <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ø© -->
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="section-title">
                    <i class="fas fa-tachometer-alt me-2"></i>
                    Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ø©
                </h2>
            </div>
        </div>

        <div class="row" id="systemMetrics">
            <div class="col-md-3 col-sm-6">
                <div class="metric-card text-center">
                    <i class="fas fa-users metric-icon text-primary"></i>
                    <div class="metric-value text-primary" id="totalEmployees">
                        <span class="loading-spinner"></span>
                    </div>
                    <div class="metric-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="metric-card text-center">
                    <i class="fas fa-play-circle metric-icon text-success"></i>
                    <div class="metric-value text-success" id="activeSessions">
                        <span class="loading-spinner"></span>
                    </div>
                    <div class="metric-label">Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="metric-card text-center">
                    <i class="fas fa-check-circle metric-icon text-info"></i>
                    <div class="metric-value text-info" id="completedSessions">
                        <span class="loading-spinner"></span>
                    </div>
                    <div class="metric-label">Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="metric-card text-center">
                    <i class="fas fa-radiation metric-icon text-warning"></i>
                    <div class="metric-value text-warning" id="totalRadiationReadings">
                        <span class="loading-spinner"></span>
                    </div>
                    <div class="metric-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª</div>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© -->
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="section-title">
                    <i class="fas fa-chart-bar me-2"></i>
                    Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù…
                </h2>
            </div>
        </div>

        <div class="row" id="totalDoses">
            <div class="col-md-3 col-sm-6">
                <div class="metric-card text-center">
                    <i class="fas fa-sun metric-icon text-info"></i>
                    <div class="metric-value text-info" id="totalDailyExposure">
                        <span class="loading-spinner"></span>
                    </div>
                    <div class="metric-label">Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© (Î¼Sv)</div>
                    <div class="progress progress-custom mt-2">
                        <div class="progress-bar progress-bar-custom bg-info" id="dailyProgress"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="metric-card text-center">
                    <i class="fas fa-calendar-week metric-icon text-primary"></i>
                    <div class="metric-value text-primary" id="totalWeeklyExposure">
                        <span class="loading-spinner"></span>
                    </div>
                    <div class="metric-label">Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© (Î¼Sv)</div>
                    <div class="progress progress-custom mt-2">
                        <div class="progress-bar progress-bar-custom bg-primary" id="weeklyProgress"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="metric-card text-center">
                    <i class="fas fa-calendar-alt metric-icon text-success"></i>
                    <div class="metric-value text-success" id="totalMonthlyExposure">
                        <span class="loading-spinner"></span>
                    </div>
                    <div class="metric-label">Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© (Î¼Sv)</div>
                    <div class="progress progress-custom mt-2">
                        <div class="progress-bar progress-bar-custom bg-success" id="monthlyProgress"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="metric-card text-center">
                    <i class="fas fa-calendar metric-icon text-warning"></i>
                    <div class="metric-value text-warning" id="totalAnnualExposure">
                        <span class="loading-spinner"></span>
                    </div>
                    <div class="metric-label">Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© (Î¼Sv)</div>
                    <div class="progress progress-custom mt-2">
                        <div class="progress-bar progress-bar-custom bg-warning" id="annualProgress"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù…Ø§Ù† -->
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="section-title">
                    <i class="fas fa-shield-alt me-2"></i>
                    ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù…Ø§Ù†
                </h2>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="chart-container">
                    <h4 class="text-center mb-3">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø­Ø³Ø¨ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ù…Ø§Ù†</h4>
                    <canvas id="safetyDistributionChart"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <h4 class="text-center mb-3">Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù…</h4>
                    <canvas id="monthlyDosesChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…ÙØµÙ„ -->
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="section-title">
                    <i class="fas fa-table me-2"></i>
                    ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                </h2>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="table-modern">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0" id="employeesTable">
                            <thead>
                                <tr>
                                    <th>Ù…Ø¹Ø±Ù Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                    <th>Ø§Ù„Ø¬Ù„Ø³Ø§Øª</th>
                                    <th>Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>
                                    <th>Ø§Ù„ØªØ¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ÙŠ</th>
                                    <th>Ø§Ù„ØªØ¹Ø±Ø¶ Ø§Ù„Ø³Ù†ÙˆÙŠ</th>
                                    <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>
                                    <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ù…Ø§Ù†</th>
                                    <th>Ø¢Ø®Ø± Ù†Ø´Ø§Ø·</th>
                                </tr>
                            </thead>
                            <tbody id="employeesTableBody">
                                <tr>
                                    <td colspan="8" class="text-center">
                                        <div class="loading-spinner me-2"></div>
                                        Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© -->
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="section-title">
                    <i class="fas fa-chart-area me-2"></i>
                    Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
                </h2>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="chart-container">
                    <h4 class="text-center mb-3">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h4>
                    <canvas id="dailyAverageChart"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <h4 class="text-center mb-3">Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©</h4>
                    <canvas id="limitsComparisonChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="section-title">
                    <i class="fas fa-info-circle me-2"></i>
                    Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©
                </h2>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="metric-card">
                    <h5><i class="fas fa-clock text-info me-2"></i>Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©</h5>
                    <div class="metric-value text-info" id="avgSessionDuration">
                        <span class="loading-spinner"></span>
                    </div>
                    <div class="metric-label">Ø¯Ù‚ÙŠÙ‚Ø©</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="metric-card">
                    <h5><i class="fas fa-atom text-success me-2"></i>Ù…ØªÙˆØ³Ø· Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¬Ø±Ø¹Ø©</h5>
                    <div class="metric-value text-success" id="avgDoseRate">
                        <span class="loading-spinner"></span>
                    </div>
                    <div class="metric-label">Î¼Sv/Ø³Ø§Ø¹Ø©</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="metric-card">
                    <h5><i class="fas fa-chart-line text-warning me-2"></i>Ø£Ø¹Ù„Ù‰ ØªØ¹Ø±Ø¶ Ù…Ø³Ø¬Ù„</h5>
                    <div class="metric-value text-warning" id="maxExposure">
                        <span class="loading-spinner"></span>
                    </div>
                    <div class="metric-label">Î¼Sv</div>
                </div>
            </div>
        </div>

        <!-- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙØ¬Ø¯ÙˆÙ„ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="alert alert-custom alert-info">
                    <h5><i class="fas fa-robot me-2"></i>Ø­Ø§Ù„Ø© Ù…ÙØ¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠØ©</h5>
                    <div id="schedulerStatus">
                        <span class="loading-spinner me-2"></span>
                        Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙØ¬Ø¯ÙˆÙ„...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3 mt-5">
        <div class="container">
            <p class="mb-0">&copy; 2025 Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø¹ Ø§Ù„Ù…ØªØ·ÙˆØ± - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
        </div>
    </footer>

    <!-- Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <script>
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        let charts = {};
        let allEmployeesData = [];
        
        // ØªØ­Ø¯ÙŠØ¯ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø£Ù…Ø§Ù†
        const SAFETY_LIMITS = {
            daily: 54.8,
            weekly: 383.6,
            monthly: 1643.8,
            annual: 20000.0
        };

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©');
            refreshAllData();
            
            // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            setInterval(updateBasicMetrics, 30000);
        });

        // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function refreshAllData() {
            console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
            
            try {
                await Promise.all([
                    loadSystemMetrics(),
                    loadEmployeesData(), 
                    loadSchedulerStatus()
                ]);
                
                updateLastRefreshTime();
                console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'danger');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        async function loadSystemMetrics() {
            try {
                // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
                const response = await fetch('/api/cumulative_doses_fast');
                const data = await response.json();
                
                if (data.success && data.employees) {
                    updateSystemMetrics(data);
                } else {
                    throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠØ©');
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…:', error);
                showAlert('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…', 'warning');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        function updateSystemMetrics(data) {
            const employees = data.employees || [];
            
            // Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            document.getElementById('totalEmployees').textContent = employees.length;
            
            let activeSessions = 0;
            let completedSessions = 0;
            let totalReadings = 0;
            let totalDailyExposure = 0;
            let totalWeeklyExposure = 0;
            let totalMonthlyExposure = 0;
            let totalAnnualExposure = 0;
            let totalDuration = 0;
            let totalExposure = 0;
            let maxExposure = 0;
            
            employees.forEach(emp => {
                activeSessions += emp.active_sessions || 0;
                completedSessions += emp.completed_sessions || 0;
                totalReadings += emp.total_readings || 0;
                totalDailyExposure += emp.daily_exposure || 0;
                totalWeeklyExposure += emp.weekly_exposure || 0;
                totalMonthlyExposure += emp.monthly_exposure || 0;
                totalAnnualExposure += emp.annual_exposure || 0;
                totalDuration += emp.total_duration_hours || 0;
                totalExposure += emp.total_cumulative_exposure || 0;
                maxExposure = Math.max(maxExposure, emp.max_single_session_exposure || 0);
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ±
            document.getElementById('activeSessions').textContent = activeSessions;
            document.getElementById('completedSessions').textContent = completedSessions;
            document.getElementById('totalRadiationReadings').textContent = totalReadings.toLocaleString();
            
            // Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©
            document.getElementById('totalDailyExposure').textContent = totalDailyExposure.toFixed(3);
            document.getElementById('totalWeeklyExposure').textContent = totalWeeklyExposure.toFixed(3);
            document.getElementById('totalMonthlyExposure').textContent = totalMonthlyExposure.toFixed(3);
            document.getElementById('totalAnnualExposure').textContent = totalAnnualExposure.toFixed(3);
            
            // Ø§Ù„ØªÙ‚Ø¯Ù…
            updateProgressBars(totalDailyExposure, totalWeeklyExposure, totalMonthlyExposure, totalAnnualExposure, employees.length);
            
            // Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
            const avgDuration = employees.length > 0 ? (totalDuration / employees.length) * 60 : 0; // Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚
            const avgDoseRate = totalDuration > 0 ? totalExposure / totalDuration : 0;
            
            document.getElementById('avgSessionDuration').textContent = avgDuration.toFixed(1);
            document.getElementById('avgDoseRate').textContent = avgDoseRate.toFixed(6);
            document.getElementById('maxExposure').textContent = maxExposure.toFixed(6);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
            updateCharts(employees);
        }

        // ØªØ­Ø¯ÙŠØ« Ø£Ø´Ø±Ø·Ø© Ø§Ù„ØªÙ‚Ø¯Ù…
        function updateProgressBars(daily, weekly, monthly, annual, employeeCount) {
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨ Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
            const dailyLimit = SAFETY_LIMITS.daily * employeeCount;
            const weeklyLimit = SAFETY_LIMITS.weekly * employeeCount;
            const monthlyLimit = SAFETY_LIMITS.monthly * employeeCount;
            const annualLimit = SAFETY_LIMITS.annual * employeeCount;
            
            const dailyPercent = Math.min((daily / dailyLimit) * 100, 100);
            const weeklyPercent = Math.min((weekly / weeklyLimit) * 100, 100);
            const monthlyPercent = Math.min((monthly / monthlyLimit) * 100, 100);
            const annualPercent = Math.min((annual / annualLimit) * 100, 100);
            
            document.getElementById('dailyProgress').style.width = dailyPercent + '%';
            document.getElementById('weeklyProgress').style.width = weeklyPercent + '%';
            document.getElementById('monthlyProgress').style.width = monthlyPercent + '%';
            document.getElementById('annualProgress').style.width = annualPercent + '%';
            
            // ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø­Ø³Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø©
            updateProgressBarColor('dailyProgress', dailyPercent);
            updateProgressBarColor('weeklyProgress', weeklyPercent);
            updateProgressBarColor('monthlyProgress', monthlyPercent);
            updateProgressBarColor('annualProgress', annualPercent);
        }

        // ØªØ­Ø¯ÙŠØ« Ù„ÙˆÙ† Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        function updateProgressBarColor(elementId, percent) {
            const element = document.getElementById(elementId);
            element.className = 'progress-bar progress-bar-custom';
            
            if (percent >= 100) {
                element.classList.add('bg-danger');
            } else if (percent >= 80) {
                element.classList.add('bg-warning');
            } else if (percent >= 50) {
                element.classList.add('bg-info');
            } else {
                element.classList.add('bg-success');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        async function loadEmployeesData() {
            try {
                const response = await fetch('/api/cumulative_doses_fast');
                const data = await response.json();
                
                if (data.success && data.employees) {
                    allEmployeesData = data.employees;
                    updateEmployeesTable(data.employees);
                } else {
                    throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†:', error);
                document.getElementById('employeesTableBody').innerHTML = 
                    '<tr><td colspan="8" class="text-center text-danger">ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</td></tr>';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function updateEmployeesTable(employees) {
            const tbody = document.getElementById('employeesTableBody');
            
            if (employees.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¸ÙÙŠÙ†</td></tr>';
                return;
            }
            
            const rows = employees.map(emp => {
                const safetyClass = getSafetyClass(emp.safety_class);
                const lastActivity = emp.last_session_date || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
                
                return `
                    <tr>
                        <td><strong>${emp.employee_id}</strong></td>
                        <td>
                            <span class="badge bg-primary">${emp.total_sessions || 0}</span>
                            <small class="text-muted d-block">
                                Ù…ÙƒØªÙ…Ù„Ø©: ${emp.completed_sessions || 0} | Ù†Ø´Ø·Ø©: ${emp.active_sessions || 0}
                            </small>
                        </td>
                        <td>
                            ${(emp.total_duration_hours || 0).toFixed(1)} Ø³Ø§Ø¹Ø©
                            <small class="text-muted d-block">
                                Ù…ØªÙˆØ³Ø·: ${(emp.average_session_duration_minutes || 0).toFixed(0)} Ø¯Ù‚ÙŠÙ‚Ø©
                            </small>
                        </td>
                        <td>
                            <strong>${(emp.total_cumulative_exposure || 0).toFixed(3)} Î¼Sv</strong>
                            <small class="text-muted d-block">
                                Ù…ØªÙˆØ³Ø·/Ø¬Ù„Ø³Ø©: ${(emp.average_exposure_per_session || 0).toFixed(3)}
                            </small>
                        </td>
                        <td>
                            <strong>${(emp.annual_exposure || 0).toFixed(3)} Î¼Sv</strong>
                        </td>
                        <td>
                            <div class="progress progress-custom" style="height: 8px;">
                                <div class="progress-bar ${getProgressBarClass(emp.annual_exposure_percentage || 0)}" 
                                     style="width: ${Math.min(emp.annual_exposure_percentage || 0, 100)}%"></div>
                            </div>
                            <small>${(emp.annual_exposure_percentage || 0).toFixed(1)}%</small>
                        </td>
                        <td>
                            <span class="safety-badge ${safetyClass}">
                                ${emp.safety_status || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                            </span>
                            <small class="text-muted d-block">
                                ${emp.risk_level || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                            </small>
                        </td>
                        <td>
                            <small>${lastActivity}</small>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = rows;
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙƒÙ„Ø§Ø³ Ø§Ù„Ø£Ù…Ø§Ù†
        function getSafetyClass(safetyClass) {
            switch(safetyClass) {
                case 'success': return 'safety-safe';
                case 'info': return 'safety-info';
                case 'warning': return 'safety-warning';
                case 'danger': return 'safety-danger';
                default: return 'safety-info';
            }
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙƒÙ„Ø§Ø³ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        function getProgressBarClass(percentage) {
            if (percentage >= 100) return 'bg-danger';
            if (percentage >= 80) return 'bg-warning';
            if (percentage >= 50) return 'bg-info';
            return 'bg-success';
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
        function updateCharts(employees) {
            updateSafetyDistributionChart(employees);
            updateMonthlyDosesChart(employees);
            updateDailyAverageChart(employees);
            updateLimitsComparisonChart(employees);
        }

        // Ø±Ø³Ù… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ù…Ø§Ù†
        function updateSafetyDistributionChart(employees) {
            const safetyCount = { success: 0, info: 0, warning: 0, danger: 0 };
            
            employees.forEach(emp => {
                const safetyClass = emp.safety_class || 'success';
                if (safetyCount.hasOwnProperty(safetyClass)) {
                    safetyCount[safetyClass]++;
                } else {
                    safetyCount.success++;
                }
            });
            
            const ctx = document.getElementById('safetyDistributionChart').getContext('2d');
            
            if (charts.safetyDistribution) {
                charts.safetyDistribution.destroy();
            }
            
            charts.safetyDistribution = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Ø¢Ù…Ù†', 'Ù…Ø±Ø§Ù‚Ø¨Ø©', 'ØªØ­Ø°ÙŠØ±', 'Ø®Ø·Ø±'],
                    datasets: [{
                        data: [safetyCount.success, safetyCount.info, safetyCount.warning, safetyCount.danger],
                        backgroundColor: ['#28a745', '#17a2b8', '#ffc107', '#dc3545'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Ø±Ø³Ù… Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
        function updateMonthlyDosesChart(employees) {
            const months = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 
                          'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
            
            // Ù„ØªØ¨Ø³ÙŠØ· Ø§Ù„Ø£Ù…Ø±ØŒ Ø³Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙ‚Ø·
            const currentMonth = new Date().getMonth();
            const monthlyData = new Array(12).fill(0);
            
            employees.forEach(emp => {
                monthlyData[currentMonth] += emp.monthly_exposure || 0;
            });
            
            const ctx = document.getElementById('monthlyDosesChart').getContext('2d');
            
            if (charts.monthlyDoses) {
                charts.monthlyDoses.destroy();
            }
            
            charts.monthlyDoses = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ© (Î¼Sv)',
                        data: monthlyData,
                        backgroundColor: '#667eea',
                        borderColor: '#764ba2',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Ø±Ø³Ù… Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
        function updateDailyAverageChart(employees) {
            const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
            const dailyData = new Array(7).fill(0);
            
            // ØªØ¨Ø³ÙŠØ·: Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙ‚Ø·
            const today = new Date().getDay();
            employees.forEach(emp => {
                dailyData[today] += emp.daily_exposure || 0;
            });
            
            const ctx = document.getElementById('dailyAverageChart').getContext('2d');
            
            if (charts.dailyAverage) {
                charts.dailyAverage.destroy();
            }
            
            charts.dailyAverage = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Î¼Sv)',
                        data: dailyData,
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Ø±Ø³Ù… Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø­Ø¯ÙˆØ¯
        function updateLimitsComparisonChart(employees) {
            let totalDaily = 0, totalWeekly = 0, totalMonthly = 0, totalAnnual = 0;
            
            employees.forEach(emp => {
                totalDaily += emp.daily_exposure || 0;
                totalWeekly += emp.weekly_exposure || 0;
                totalMonthly += emp.monthly_exposure || 0;
                totalAnnual += emp.annual_exposure || 0;
            });
            
            const limits = [
                SAFETY_LIMITS.daily * employees.length,
                SAFETY_LIMITS.weekly * employees.length, 
                SAFETY_LIMITS.monthly * employees.length,
                SAFETY_LIMITS.annual * employees.length
            ];
            
            const actual = [totalDaily, totalWeekly, totalMonthly, totalAnnual];
            
            const ctx = document.getElementById('limitsComparisonChart').getContext('2d');
            
            if (charts.limitsComparison) {
                charts.limitsComparison.destroy();
            }
            
            charts.limitsComparison = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ÙŠÙˆÙ…ÙŠ', 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', 'Ø´Ù‡Ø±ÙŠ', 'Ø³Ù†ÙˆÙŠ'],
                    datasets: [{
                        label: 'Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© (Î¼Sv)',
                        data: actual,
                        backgroundColor: '#ffc107'
                    }, {
                        label: 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ (Î¼Sv)',
                        data: limits,
                        backgroundColor: '#dc3545'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙØ¬Ø¯ÙˆÙ„
        async function loadSchedulerStatus() {
            try {
                const response = await fetch('/api/scheduler/status');
                const data = await response.json();
                
                updateSchedulerStatus(data);
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙØ¬Ø¯ÙˆÙ„:', error);
                document.getElementById('schedulerStatus').innerHTML = 
                    '<span class="text-danger">ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙØ¬Ø¯ÙˆÙ„</span>';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙØ¬Ø¯ÙˆÙ„
        function updateSchedulerStatus(data) {
            const statusDiv = document.getElementById('schedulerStatus');
            
            if (!data.available) {
                statusDiv.innerHTML = '<span class="text-warning">Ø§Ù„Ù…ÙØ¬Ø¯ÙˆÙ„ ØºÙŠØ± Ù…ØªØ§Ø­</span>';
                return;
            }
            
            if (!data.initialized) {
                statusDiv.innerHTML = '<span class="text-info">Ø§Ù„Ù…ÙØ¬Ø¯ÙˆÙ„ ØºÙŠØ± Ù…ÙØ¹Ø±ÙÙ‘Ù</span>';
                return;
            }
            
            const isRunning = data.is_running;
            const statusText = isRunning ? 'ÙŠØ¹Ù…Ù„' : 'Ù…ØªÙˆÙ‚Ù';
            const statusClass = isRunning ? 'text-success' : 'text-warning';
            const statusIcon = isRunning ? 'fa-check-circle' : 'fa-pause-circle';
            
            let html = `
                <div class="d-flex align-items-center">
                    <i class="fas ${statusIcon} ${statusClass} me-2"></i>
                    <strong class="${statusClass}">Ø§Ù„Ø­Ø§Ù„Ø©: ${statusText}</strong>
                </div>
            `;
            
            if (isRunning) {
                html += `
                    <div class="mt-2">
                        <small class="text-muted">
                            ÙØªØ±Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«: ÙƒÙ„ ${data.update_interval_minutes || 5} Ø¯Ù‚ÙŠÙ‚Ø© |
                            Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ù…Ù„: ÙƒÙ„ ${data.force_update_interval_hours || 1} Ø³Ø§Ø¹Ø©
                        </small>
                    </div>
                `;
            }
            
            statusDiv.innerHTML = html;
        }

        // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø®ÙŠØ±
        function updateLastRefreshTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ar-SA', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            document.getElementById('lastUpdate').textContent = timeString;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙÙ‚Ø· (Ù„Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ)
        async function updateBasicMetrics() {
            try {
                await loadSystemMetrics();
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:', error);
            }
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        function exportReport() {
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ CSV
            let csvContent = "Ù…Ø¹Ø±Ù Ø§Ù„Ù…ÙˆØ¸Ù,Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¬Ù„Ø³Ø§Øª,Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø³Ø§Ø¹Ø§Øª,Ø§Ù„ØªØ¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ÙŠ,Ø§Ù„ØªØ¹Ø±Ø¶ Ø§Ù„Ø³Ù†ÙˆÙŠ,Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©,Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ù…Ø§Ù†\n";
            
            allEmployeesData.forEach(emp => {
                csvContent += `"${emp.employee_id}",${emp.total_sessions || 0},${(emp.total_duration_hours || 0).toFixed(1)},${(emp.total_cumulative_exposure || 0).toFixed(3)},${(emp.annual_exposure || 0).toFixed(3)},${(emp.annual_exposure_percentage || 0).toFixed(1)},${emp.safety_status || ''}\n`;
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `radiation_report_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        function printReport() {
            window.print();
        }

        // Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡
        function showAlert(message, type = 'info') {
            // ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ† Ù‡Ø°Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Toast Ø£Ùˆ Modal
            console.log(`${type.toUpperCase()}: ${message}`);
        }
    </script>
</body>
</html>