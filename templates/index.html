<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DoseMeter - Radiation Exposure Monitoring</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>â˜¢ï¸</text></svg>">
</head>
<body class="modern-body">
    <header class="main-header">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
        <nav class="navbar navbar-expand-lg navbar-dark modern-navbar">
            <div class="container-fluid">
                <a class="navbar-brand d-flex align-items-center" href="#">
                    <i class="fas fa-radiation-alt me-2"></i>
<span class="brand-text">DoseMeter</span>
                </a>
                <div class="navbar-nav ms-auto d-flex align-items-center">
<a class="nav-link modern-nav-link" href="/attendance">
                        <i class="fas fa-user-clock me-1"></i>
                        Attendance
                    </a>
<a class="nav-link modern-nav-link" href="/reports">
                        <i class="fas fa-chart-bar me-1"></i>
                        Reports
                    </a>
                    {% include 'navbar_alerts.html' %}
                    <div class="navbar-text ms-3 d-flex align-items-center">
                        <i class="fas fa-clock me-1"></i>
                        <span id="current-time" class="time-display"></span>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="main-content">
        <div class="container-fluid">
            <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <section class="hero-section text-center py-5">
                <div class="container">
<h1 class="display-4 mb-3 main-title">
                        <i class="fas fa-atom me-3"></i>
                        Radiation Monitoring System
                        <i class="fas fa-shield-alt ms-3"></i>
                    </h1>
<p class="lead subtitle">
                        <i class="fas fa-microchip me-2"></i>
                        Continuous monitoring of radiation exposure using GGreg20_3 sensor
                    </p>
                </div>
            </section>

            <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø¹ -->
            <section class="radiation-metrics py-5">
                <div class="container">
                    <div class="text-center mb-4">
<button class="btn btn-primary btn-lg" onclick="manualRefresh()">
                            <i class="fas fa-sync-alt"></i> Refresh Data
                        </button>
                        <p class="mt-2 text-muted">Last update: <span id="last-update">--</span></p>
                    </div>
                    <div class="row g-4 mb-5">
                        <!-- CPM -->
                        <div class="col-lg-3 col-md-6">
                            <div class="metric-card cpm-card">
                                <div class="card-body text-center">
                                    <div class="metric-icon">
                                        <i class="fas fa-tachometer-alt"></i>
                                    </div>
                                    <h5 class="metric-title">CPM</h5>
                                    <div class="metric-value" id="cpm-value">--</div>
<p class="metric-unit">counts/min</p>
                                    <div class="metric-status" id="cpm-status">
<span class="status-badge">Measuring...</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Source Power -->
                        <div class="col-lg-3 col-md-6">
                            <div class="metric-card source-power-card">
                                <div class="card-body text-center">
                                    <div class="metric-icon">
                                        <i class="fas fa-bolt"></i>
                                    </div>
                                    <h5 class="metric-title">Source Power</h5>
                                    <div class="metric-value" id="source-power-value">--</div>
                                    <p class="metric-unit">Î¼Sv/h</p>
                                    <div class="metric-status" id="source-power-status">
                                        <span class="status-badge">Measuring...</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Absorbed Dose -->
                        <div class="col-lg-3 col-md-6">
                            <div class="metric-card absorbed-dose-card">
                                <div class="card-body text-center">
                                    <div class="metric-icon">
                                        <i class="fas fa-radiation-alt"></i>
                                    </div>
                                    <h5 class="metric-title">Absorbed Dose</h5>
                                    <div class="metric-value" id="absorbed-dose-value">--</div>
                                    <p class="metric-unit">Î¼Sv/h</p>
                                    <div class="metric-status" id="absorbed-dose-status">
                                        <span class="status-badge">Measuring...</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Total Dose -->
                        <div class="col-lg-3 col-md-6">
                            <div class="metric-card total-dose-card">
                                <div class="card-body text-center">
                                    <div class="metric-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <h5 class="metric-title">Total Dose</h5>
                                    <div class="metric-value" id="total-dose-value">--</div>
                                    <p class="metric-unit">Î¼Sv</p>
                                    <div class="metric-status" id="total-dose-status">
                                        <span class="status-badge">Measuring...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
                <section class="system-tools py-5">
                    <div class="container">
                        <div class="tools-card">
                            <div class="tools-header">
<h3 class="tools-title">
                                    <i class="fas fa-tools me-2"></i>
                                    System Tools & Management
                                </h3>
                            </div>
                            <div class="tools-body">
                                <!-- Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ -->
                                <div class="row g-4 mb-4">
                                    <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù -->
                                    <div class="col-md-6 col-lg-3">
                                        <div class="tool-item attendance-tool">
                                            <div class="tool-icon">
                                                <i class="fas fa-user-clock"></i>
                                            </div>
<h6 class="tool-title">Attendance</h6>
<a href="/attendance" class="tool-button">
                                                <i class="fas fa-sign-in-alt me-2"></i>
                                                Record Attendance
                                            </a>
                                        </div>
                                    </div>

                                    <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
                                    <div class="col-md-6 col-lg-3">
                                        <div class="tool-item employees-tool">
                                            <div class="tool-icon">
                                                <i class="fas fa-users"></i>
                                            </div>
<h6 class="tool-title">Employees</h6>
<a href="{{ url_for('add_employee') }}" class="tool-button">
                                                <i class="fas fa-user-plus me-2"></i>
                                                Add Employee
                                            </a>
                                        </div>
                                    </div>

                                    <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ­Ø¯Ø© -->
                                    <div class="col-md-6 col-lg-3">
                                        <div class="tool-item reports-tool">
                                            <div class="tool-icon">
                                                <i class="fas fa-chart-line"></i>
                                            </div>
<h6 class="tool-title">Unified Reports</h6>
<a href="/unified_reports" class="tool-button">
                                                <i class="fas fa-analytics me-2"></i>
                                                View
                                            </a>
                                        </div>
                                    </div>

                                    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ù†Ø¨ÙˆØ¨ -->
                                    <div class="col-md-6 col-lg-3">
                                        <div class="tool-item settings-tool">
                                            <div class="tool-icon">
                                                <i class="fas fa-vial"></i>
                                            </div>
<h6 class="tool-title">Sensor Settings</h6>
<a href="/tube_selector" class="tool-button">
                                                <i class="fas fa-cog me-2"></i>
                                                Tube Selector
                                            </a>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
            </section>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
    <script src="{{ url_for('static', filename='js/radiation.js') }}"></script>

    <!-- Ù†Ø¸Ø§Ù… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø³Ø· -->
    <script>
        console.log('ğŸš€ Starting lightweight data refresh system...');

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function updateRadiationData() {
            try {
                console.log('ğŸ“¡ Fetching radiation data...');

                const response = await fetch('/api/radiation_data?t=' + Date.now());
                const data = await response.json();

                console.log('ğŸ“¥ Received data:', data);

                if (data.success && data.data) {
                    const radiationData = data.data;

                    // ØªØ­Ø¯ÙŠØ« CPM
                    const cpmElement = document.getElementById('cpm-value');
                    if (cpmElement) {
                        cpmElement.textContent = radiationData.cpm || '--';
                        console.log('âœ… CPM updated:', radiationData.cpm);
                    }

                    // ØªØ­Ø¯ÙŠØ« Source Power
                    const sourcePowerElement = document.getElementById('source-power-value');
                    if (sourcePowerElement) {
                        sourcePowerElement.textContent = radiationData.sourcePower ? radiationData.sourcePower.toFixed(5) : '--';
                        console.log('âœ… Source Power updated:', radiationData.sourcePower);
                    }

                    // ØªØ­Ø¯ÙŠØ« Absorbed Dose
                    const absorbedDoseElement = document.getElementById('absorbed-dose-value');
                    if (absorbedDoseElement) {
                        absorbedDoseElement.textContent = radiationData.absorbedDose ? radiationData.absorbedDose.toFixed(5) : '--';
                        console.log('âœ… Absorbed Dose updated:', radiationData.absorbedDose);
                    }

                    // ØªØ­Ø¯ÙŠØ« Total Dose
                    const totalDoseElement = document.getElementById('total-dose-value');
                    if (totalDoseElement) {
                        totalDoseElement.textContent = radiationData.totalDose ? radiationData.totalDose.toFixed(5) : '--';
                        console.log('âœ… Total Dose updated:', radiationData.totalDose);
                    }

                    // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
                    const lastUpdateElement = document.getElementById('last-update');
                    if (lastUpdateElement) {
                        lastUpdateElement.textContent = new Date().toLocaleString('en-US');
                    }

                    console.log('âœ… All data updated successfully');
                } else {
                    console.error('âŒ Failed to fetch data:', data);
                }
            } catch (error) {
                console.error('âŒ Error updating data:', error);
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ Page loaded - starting update...');

            // ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ
            updateRadiationData();

            // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 5 Ø«ÙˆØ§Ù†Ù
            setInterval(updateRadiationData, 5000);

            console.log('â° Auto-update set to every 5 seconds');
        });

        // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙŠØ¯ÙˆÙŠ
        function manualRefresh() {
            console.log('ğŸ”„ Manual refresh...');
            updateRadiationData();
        }
    </script>
</body>
</html>
